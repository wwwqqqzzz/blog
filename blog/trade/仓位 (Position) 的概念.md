---
title: "仓位 (Position) 的概念"
date: 2025-08-25
authors: [wqz]
tags: [交易, 量化, 仓位, 市场中性, 权重]
collection: 量化交易系列
collection_order: 4
collection_description: "从零开始的量化交易学习系列，涵盖 Alpha 概念、平台设置、股票池、仓位与中性化、技术分析与PV数据、基本面与期权等，配合实操思路帮助你构建体系化认知。"
image: "https://images.unsplash.com/photo-1559526324-593bc073d938?q=80&w=1200&auto=format&fit=crop"
---

首先，你需要了解什么是**仓位**。仓位决定了你要买入或卖出多少股票。

- **多头仓位 (Long Position)：** 这意味着你**买入**股票，并期望它的价格会上涨。
- **空头仓位 (Short Position)：** 这意味着你**卖出**股票，并期望它的价格会下跌。这是一种做空的策略，即使在熊市中也有可能盈利。

在模拟过程中，系统会为每一只股票计算一个仓位，来决定是买入还是卖出。![image-20250824233723831](https://cdn.jsdelivr.net/gh/wwwqqqzzz/Image/img/1756134612969-50da7fde3a344f2b92ba2a45468dc074.png)

------

### 表达式计算

这是模拟的第一步，系统会运行你输入的公式。

- **`rank()` 函数：** `rank()` 的作用是给一堆数值**排序**，并把它们均匀地分配在 0 到 1 之间。

  举个例子，假设有 5 只股票，它们的 `-returns` 值各不相同。`rank()` 函数会给它们排名，然后把排名结果转换为 0、0.25、0.5、0.75、1 这五个值。

  - `-returns` 值最大的股票，`rank()` 结果是 1。
  - `-returns` 值最小的股票，`rank()` 结果是 0。
  - 中间的股票则根据大小得到相应的分数。

  在您的例子中，公式 `rank(-returns)` 就是将每只股票的“昨天回报率的反向值”进行排名。这意味着，昨天跌得最惨的股票，会得到最高的 `rank()` 值（最接近 1）；而昨天涨得最多的股票，会得到最低的 `rank()` 值（最接近 0）。

------

### 市场中性化 (Market Neutralization)

这是非常关键的一步，它让你的投资策略更加稳健。

- **为什么要中性化？** 股票的价格通常会受到整个大盘走势的影响。如果你只买入（做多）股票，那么当市场整体下跌时，你的所有股票可能都会跟着跌，这会带来很大的风险。

- **什么是中性化？** 中性化的目的就是**消除大盘对你策略的影响**。平台通过构建一个“多头-空头”组合来实现中性化，也就是一半仓位做多，另一半仓位做空。

  这样一来，无论市场整体是涨是跌，你的策略都能保持稳定。如果市场大涨，你的多头仓位会盈利，但空头仓位可能会亏损，二者可以对冲；如果市场大跌，你的空头仓位会盈利，从而弥补多头仓位的损失。![image-20250824233751878](https://cdn.jsdelivr.net/gh/wwwqqqzzz/Image/img/1756134612969-9df4128a9fdfeb6144e23d084785e355.png)

- 在平台上，你的投资策略如何被执行和优化的？

  ------

  ### 市场中性化：多头-空头组合的威力 ⚖️

  ![image-20250824234856816](https://cdn.jsdelivr.net/gh/wwwqqqzzz/Image/img/1756134612969-520599691d23308d12ea1601d75f82a4.png)

  你可能会发现，无论你的策略是预测股价上涨（多头）还是下跌（空头），如果只持有单一方向的仓位，你的投资组合都很难摆脱整个大盘的影响。

  - **只做多（Long-only）的问题：** 假设你预测10只股票都会上涨，并买入了它们。如果当天大盘突然暴跌，即使你的预测是正确的，这10只股票很可能还是会跟着市场一起下跌，导致你亏钱。这种风险叫做**市场风险**。

  为了解决这个问题，平台引入了**市场中性化**的概念。核心思想是：**同时做多和做空，让多头仓位的总价值等于空头仓位的总价值**。

  **为什么这么做？** 这么做的好处是，你的投资组合不再受大盘整体涨跌的影响，而只取决于你选股的准确性。

  - 如果大盘上涨，你的多头仓位会赚更多钱，但空头仓位会亏一些钱，两者对冲后，你的净收益仍然是正的。
  - 如果大盘下跌，你的空头仓位会赚钱，弥补了多头仓位的损失，你的净收益可能仍然是正的。

  这就像是你在玩一个只与你个人技巧相关的游戏，而不是受限于整个市场的波动。

  

  ### 仓位分配的三个步骤：

  

  平台每天都会通过三个主要步骤来为你的投资策略分配仓位：

  1. **居中归零（Centered around 0）：** 首先，系统会计算出你所有股票的 Alpha 值（比如 `-returns` 排名后得到的 0 到 1 的值），然后减去它们的平均值。这样做的目的是让所有股票的 Alpha 值围绕 0 居中，正值代表做多，负值代表做空。
  2. **标准化权重（Normalized weights）：** 接下来，系统会将这些居中后的值进行处理，确保所有值的绝对值加起来等于 1。这样就得到了每只股票的“权重”，方便后续计算。
  3. **分配资金（Assign capital）：** 最后，系统会根据这些权重来分配你的总投资资金（比如 2000 万美元），决定每只股票具体要买入或卖出多少。![image-20250824235029384](https://cdn.jsdelivr.net/gh/wwwqqqzzz/Image/img/1756134612969-118206b31f34975714dc7452ee4007b4.png)

  通过这三个步骤，你的 Alpha 模型每天都会得到一个多空平衡的仓位列表，从而实现市场中性化。

  ------

  ### 衰减（Decay）：控制仓位变化的速度 🍂

  

  有时，你的 Alpha 策略可能每天都会产生非常大的仓位变化。比如，`rank(-returns)` 策略可能需要每天都大幅调整多头和空头仓位，以适应最新的价格反转。

  **为什么这会是个问题？** 过于频繁和剧烈的仓位变动会带来两个问题：

  - **交易成本：** 频繁买卖会产生高昂的交易佣金和滑点（实际成交价与预期价格的偏差），侵蚀你的利润。
  - **稳定性：** 过于激进的策略可能在短期内表现良好，但缺乏稳定性，容易在特定市场环境下遭遇重大亏损。

  为了解决这个问题，我们可以引入**衰减（Decay）**。![image-20250824234937526](https://cdn.jsdelivr.net/gh/wwwqqqzzz/Image/img/1756134612969-27300b5d30b299bf1cac699e5d5547f1.png)

  - **什么是衰减？** 衰减是一种平滑仓位变化的方法，它将你过去几天的仓位也考虑进来，而不是只看今天的数据。
  - **如何工作？** 举例来说，如果你设置了 3 天的衰减，那么今天的最终仓位不是完全由今天的 Alpha 值决定，而是由今天、昨天和大前天的 Alpha 值加权平均而来。今天的数据权重最高，昨天次之，大前天最低。

  **衰减公式：**

  ```
  Decay_linear(x,n) = (x[今天]*n + x[昨天]*(n-1) + ... + x[n天前]*1) / (n + (n-1) + ... + 1)
  ```

  **优点与缺点：**

  - **优点：** 衰减能让你的投资组合更加稳定，减少不必要的交易成本，并平滑掉一些短期噪声。
  - **缺点：** 衰减会削弱你信号的**实时性**。因为今天的仓位中包含了过去几天的数据，所以对今天最新信号的反应会变得迟钝。

  通常，衰减的参数会设置在 10 以下，以在信号强度和仓位稳定性之间取得平衡。